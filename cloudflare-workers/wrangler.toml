# Cloudflare Workers Configuration for FareLens
# This worker acts as a secure API proxy between iOS app and backend services

name = "farelens-api"
main = "src/index.ts"
compatibility_date = "2025-10-27"
workers_dev = true

# Account ID - REPLACE WITH YOUR CLOUDFLARE ACCOUNT ID
# Find it at: https://dash.cloudflare.com (Workers & Pages > right sidebar)
# Or override locally with wrangler.toml.local (already in .gitignore)
account_id = "YOUR_ACCOUNT_ID_HERE"

# KV Namespaces (for caching Amadeus API responses)
# Create with: wrangler kv:namespace create CACHE
# Then replace the ID below with the output from that command
[[kv_namespaces]]
binding = "CACHE"
id = "YOUR_KV_NAMESPACE_ID_HERE"

# Environment Variables (NON-SECRET, safe to commit)
[vars]
ENVIRONMENT = "development"
API_VERSION = "v1"
CORS_ALLOW_ORIGIN = "farelens://app"  # iOS app deep link scheme

# Secrets (NEVER COMMIT THESE - set via `wrangler secret put <KEY>`)
# After deployment, run these commands:
# npx wrangler secret put SUPABASE_URL
# npx wrangler secret put SUPABASE_ANON_KEY          # Publishable key (respects RLS)
# npx wrangler secret put SUPABASE_SECRET_KEY        # Service role key (admin access)
# npx wrangler secret put AMADEUS_API_KEY
# npx wrangler secret put AMADEUS_API_SECRET
#
# Optional: Override Amadeus API base URL for production
# npx wrangler secret put AMADEUS_BASE_URL          # Default: https://test.api.amadeus.com

# Routes (production domain mapping)
# Uncomment when you have a custom domain
# routes = [
#   { pattern = "api.farelens.app/*", zone_name = "farelens.app" }
# ]

# Build configuration
[build]
command = "npm run build"
